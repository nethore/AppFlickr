$(document).ready(function(){function e(e){var a=e[e.length-1];console.log(a),n(o,a),$(".selecteur li a").parent().removeClass("active"),$(".selecteur li a[name="+a+"]").parent().addClass("active")}function a(e){$('div.chip-holder div.chip[name="'+e+'"]').remove(),$('ul#nav-mobile li a[name="'+e+'"]').parent().remove(),$('ul#mobile-demo li a[name="'+e+'"]').parent().remove()}function i(e){for(var a="",i="",t="",s=0;s<e.length;s++)a+='<li><a href="#" name="'+e[s]+'">'+e[s]+"</a></li>",console.log(a),i+='<li><a href="#" name="'+e[s]+'">'+e[s]+"</a></li>",t+='<div class="chip" name="'+e[s]+'">'+e[s]+'<i class="close-chip material-icons">close</i></div>';$("div.chip-holder").append(t),$("ul#nav-mobile").append(a),$("ul#mobile-demo").append(i)}function t(e){$("ul#nav-mobile li").remove(),$("ul#mobile-demo li").remove(),$("div.chip-holder div.chip").remove();for(var a="",i="",t="",s=0;s<e.length;s++)a+='<li><a href="#" name="'+e[s]+'">'+e[s]+"</a></li>",console.log(a),i+='<li><a href="#" name="'+e[s]+'">'+e[s]+"</a></li>",t+='<div class="chip" name="'+e[s]+'">'+e[s]+'<i class="close-chip material-icons">close</i></div>';$("div.chip-holder").append(t),$("ul#nav-mobile").append(a),$("ul#mobile-demo").append(i)}function s(e){var a="";$.each(e.items,function(e,i){return e!=l&&(a+='<div class="grid-item"><div class="card light-blue darken-3">',a+='<div class="card-image waves-effect waves-block waves-light"><img class="activator" src="'+i.media.m+'"></div>',a+='<div class="card-reveal"><span class="card-title grey-text text-darken-4">Tags<i class="material-icons right">close</i></span><p class="tags"><span>'+i.tags+'</span></p><p><a class="waves-effect waves-light btn" href="'+i.link+'" target="_blank">Ouvrir  sur Flickr</a></p></div>',void(a+="</div></div>"))}),$(".loader-div").show(),$(".grid").html(a).css("visibility","hidden").masonry("reloadItems").imagesLoaded(function(){$(".grid").masonry().css("visibility","visible")}).done(function(){$(".loader-div").hide()})}function n(e,a){$.ajax({url:e,dataType:"jsonp",data:{tags:a,format:"json"},success:function(e){s(e)}})}$(".affiche-sidebar").sideNav(),$(".button-collapse").sideNav({edge:"right"}),$(".grid").masonry({itemSelector:".grid-item",gutter:20,fitWidth:!0,columnWidth:300});var o="http://api.flickr.com/services/feeds/photos_public.gne?jsoncallback=?",l=20,r=[];sessionStorage.tags?(r=JSON.parse(sessionStorage.tags),console.log("SS",r)):(r=["bateau","avion","train","velo","voiture"],console.log("SS Vide")),currentTag=r[r.length-1];var c=/[^\, ]+/gi;t(r),console.log("First Array",r),e(r),$("input#range-image").change(function(){l=$("input#range-image").val(),$("span.img-counter").text(l),n(o,currentTag)}),$("button#add-tag").click(function(){var a=$(this).parents("#slide-out").find("input#tags").val().toLowerCase();if(""!==a){var t=a.match(c);console.log(r),r=r.concat(t),console.log(r),sessionStorage.setItem("tags",JSON.stringify(r)),i(t),e(r),Materialize.toast("Tag(s) ajouté(s)",2e3),$(this).parents("form").find("input#tags").val("")}}),$("input#tags").bind("keypress",function(a){if(13==a.keyCode){var t=$(this).val().toLowerCase();if(""!==t){var s=t.match(c);r=r.concat(s),sessionStorage.setItem("tags",JSON.stringify(r)),i(s),e(r),Materialize.toast("Tag(s) ajouté(s)",2e3),$(this).val("")}}}),$("div.chip-holder").on("click","i.close-chip",function(){var i=$(this).parent().attr("name"),t=r.indexOf(i);t>-1&&r.splice(t,1),sessionStorage.setItem("tags",JSON.stringify(r)),console.log(r),a(i),e(r)}),$(".selecteur").on("click","a",function(){$(this).parents(".selecteur").find("li").removeClass("active"),$(this).parent().addClass("active"),$(this).sideNav("hide")}),$(".selecteur").on("click","a",function(){currentTag=$(this).attr("name"),n(o,currentTag)}),$(".loader-div").hide().ajaxStart(function(){$(this).show()}).ajaxStop(function(){$(this).hide()})});